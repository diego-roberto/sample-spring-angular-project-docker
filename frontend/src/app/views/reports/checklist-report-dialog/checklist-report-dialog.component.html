<form [formGroup]="checklistReportItemForm" fxFlex="100">
  <safety-dialog>
    <safety-dialog-header>
      Gerar Relatório
    </safety-dialog-header>

    <safety-dialog-content fxLayout="column" class="safety-dialog-content">
      <div fxLayout="row" fxLayout.lt-md="column">
        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
            Selecionar as obras
          </md-card-subtitle>

          <md-input-container>
            <md-icon mdPrefix>search</md-icon>
            <input mdInput #filter (input)="doFilterConstructions(filter.value)" placeholder="Buscar por nome">
            <md-icon mdSuffix (click)="doClearFilterConstructions()">clear</md-icon>
          </md-input-container>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToAdd()" [checked]="isAllToAdd()" [disabled]="isAllToAddDisabled()"></md-checkbox>
              <div>
                <p class="bolder">Todas</p>
              </div>
              <md-checkbox (change)="setActiveFilter()" [checked]="checkedActive"></md-checkbox>
              <div>
                  <p class="bolder">Apenas em andamento</p>
              </div>
            </md-list-item>
            <virtual-scroll #constructionsVirtualScroll [items]="constructionsFiltered" [childHeight]="50" (update)="constructionsVirtualScrollItems = $event">
              <md-list-item *ngFor="let construction of constructionsVirtualScrollItems">
                <md-checkbox (change)="setSelectedToAdd(construction)" [checked]="selectedToAdd.includes(construction)"></md-checkbox>
                <div>
                  <p class="bolder">{{ construction.name }}</p>
                </div>
              </md-list-item>
            </virtual-scroll>
          </md-list>
        </div>

        <div fxLayout="column" fxLayout.lt-md="row" class="button-group" fxLayoutAlign="center none">
            <button md-button [disabled]="isDoAddDisabled()" (click)="doAdd()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_right</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_down</md-icon>
            </button>
            <button md-button [disabled]="isDoRemoveDisabled()" (click)="doRemove()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_left</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_up</md-icon>
            </button>
        </div>

        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <h6>Obras <span class="red-text-highlighted">selecionadas</span> ({{ constructionsSelected ? constructionsSelected.length : 0 }})</h6>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToRemove()" [checked]="isAllToRemove()" [disabled]="isAllToRemoveDisabled()"></md-checkbox>
              <div>
                <p class="bolder">Todas</p>
              </div>
            </md-list-item>

            <virtual-scroll #constructionsSelectedVirtualScroll [items]="constructionsSelectedFiltered" [childHeight]="50" (update)="constructionsSelectedVirtualScrollItems = $event">
              <md-list-item *ngFor="let construction of constructionsSelectedVirtualScrollItems">
                <md-checkbox (change)="setSelectedToRemove(construction)" [checked]="selectedToRemove.includes(construction)"></md-checkbox>
                <div>
                  <p class="bolder">{{ construction.name }}</p>
                </div>
              </md-list-item>

              <div *ngIf="showEmptySelectionMessage()" class="empty-selection-message">
                  <p>Clique no item e na seta ao lado para adicionar obras ao relatório.</p>
                  <p>Será gerado relatório com <strong>todas</strong> caso nenhuma seja selecionada.</p>
              </div>
            </virtual-scroll>
          </md-list>
        </div>
      </div>

      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar o Formato do Relatório
      </md-card-subtitle>
      <md-select id="report-type" formControlName="reportType" fxFlex="100" [(ngModel)]="reportRequest.reportType">
        <md-option *ngFor="let rt of reportTypes" [value]="rt">
          {{rt}}
        </md-option>
      </md-select>

      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar o Período
      </md-card-subtitle>
      <div fxlayout="row" fxLayout.lt-md="column" fxLayoutGap="2em">
        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.initialDate" dateMask="99/99/9999"
            formControlName="initialDate" [mdDatepicker]="initialDateDatePicker" placeholder="data início">
          <button mdSuffix [mdDatepickerToggle]="initialDateDatePicker"></button>
          <md-datepicker #initialDateDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorForm('initialDate', 'initialAfterfinalDate')">data maior que a data final.
          </md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialDate', 'beforeToday')">data maior que a data atual.
          </md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialDate', 'invalid')">data inválida.</md-error>
          <md-error
            *ngIf="hasErrorFormAndTouched('initialDate', 'required') && !hasErrorFormAndTouched('initialDate', 'invalid')">
            campo obrigatório.</md-error>
        </md-input-container>

        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.finalDate" dateMask="99/99/9999"
            formControlName="finalDate" [mdDatepicker]="finalDateDatePicker" placeholder="data fim">
          <button mdSuffix [mdDatepickerToggle]="finalDateDatePicker"></button>
          <md-datepicker #finalDateDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorFormAndTouched('finalDate', 'beforeToday')">data maior que a data atual.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('finalDate', 'invalid')">data inválida.</md-error>
          <md-error
            *ngIf="hasErrorFormAndTouched('finalDate', 'required') && !hasErrorFormAndTouched('finalDate', 'invalid')">
            campo obrigatório.</md-error>
        </md-input-container>
      </div>
    </safety-dialog-content>

    <safety-dialog-actions>
      <button md-button class="button-red" [disabled]="checklistReportItemForm.invalid || this.loading"
        (click)="printReport()" [class.spinner]="this.loading">
        Gerar Relatório
      </button>
    </safety-dialog-actions>
  </safety-dialog>
</form>
