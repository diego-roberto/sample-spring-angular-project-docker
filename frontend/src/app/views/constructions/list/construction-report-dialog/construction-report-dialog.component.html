<form [formGroup]="constructionReportForm" fxFlex="100">
  <safety-dialog>
    <safety-dialog-header>
      Gerar Relatório
    </safety-dialog-header>

    <safety-dialog-content fxLayout="column">
      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar Relatório
      </md-card-subtitle>

      <md-select id="construction-report-type" formControlName="constructionReportType" fxFlex="100">
        <md-option *ngFor="let reportType of constructionReportType.values()" [value]="reportType">{{ getReportLabelByType(reportType) }}</md-option>
      </md-select>

      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar o Período
      </md-card-subtitle>

      <div fxlayout="row" fxLayout.lt-md="column" fxLayoutGap="2em">
        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.initialPeriod" dateMask="99/99/9999" formControlName="initialPeriod" [mdDatepicker]="initialPeriodDatePicker" placeholder="data início">
          <button mdSuffix [mdDatepickerToggle]="initialPeriodDatePicker"></button>
          <md-datepicker #initialPeriodDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorForm('initialPeriod', 'initialAfterFinalPeriod')">data maior que a data final.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialPeriod', 'invalid')">data inválida.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialPeriod', 'required') && !hasErrorFormAndTouched('initialPeriod', 'invalid')">campo obrigatório.</md-error>
        </md-input-container>

        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.finalPeriod" dateMask="99/99/9999" formControlName="finalPeriod" [mdDatepicker]="finalPeriodDatePicker" placeholder="data fim">
          <button mdSuffix [mdDatepickerToggle]="finalPeriodDatePicker"></button>
          <md-datepicker #finalPeriodDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorForm('finalPeriod', 'initialAfterFinalPeriod')">data menor que a data inicial.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('finalPeriod', 'invalid')">data inválida.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('finalPeriod', 'required') && !hasErrorFormAndTouched('finalPeriod', 'invalid')">campo obrigatório.</md-error>
        </md-input-container>
      </div>

      <div fxLayout="row" fxLayout.lt-md="column">
        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <h6>Selecione as obras</h6>

          <md-input-container>
            <md-icon mdPrefix>search</md-icon>
            <input mdInput #filter (input)="doFilterConstructions(filter.value)" placeholder="Buscar por nome">
            <md-icon mdSuffix (click)="doClearFilterConstructions()">clear</md-icon>
          </md-input-container>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToAdd()" [checked]="isAllToAdd()" [disabled]="isAllToAddDisabled()"></md-checkbox>
              <div>
                <p class="bolder">Todas</p>
              </div>
            </md-list-item>
            <virtual-scroll #constructionsVirtualScroll [items]="constructionsFiltered" [childHeight]="50" (update)="constructionsVirtualScrollItems = $event">
              <md-list-item *ngFor="let construction of constructionsVirtualScrollItems">
                <md-checkbox (change)="setSelectedToAdd(construction)" [checked]="selectedToAdd.includes(construction)"></md-checkbox>
                <div>
                  <p class="bolder">{{ construction.name }}</p>
                </div>
              </md-list-item>
            </virtual-scroll>
          </md-list>
        </div>

        <div fxLayout="column" fxLayout.lt-md="row" class="button-group" fxLayoutAlign="end none">
            <button md-button [disabled]="isDoAddDisabled()" (click)="doAdd()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_right</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_down</md-icon>
            </button>
            <button md-button [disabled]="isDoRemoveDisabled()" (click)="doRemove()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_left</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_up</md-icon>
            </button>
        </div>

        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <h6>Obras <span class="red-text-highlighted">selecionadas</span> ({{ constructionsSelected ? constructionsSelected.length : 0 }})</h6>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToRemove()" [checked]="isAllToRemove()" [disabled]="isAllToRemoveDisabled()"></md-checkbox>
              <div>
                <p class="bolder">Todas</p>
              </div>
            </md-list-item>

            <virtual-scroll #constructionsSelectedVirtualScroll [items]="constructionsSelectedFiltered" [childHeight]="50" (update)="constructionsSelectedVirtualScrollItems = $event">
              <md-list-item *ngFor="let construction of constructionsSelectedVirtualScrollItems">
                <md-checkbox (change)="setSelectedToRemove(construction)" [checked]="selectedToRemove.includes(construction)"></md-checkbox>
                <div>
                  <p class="bolder">{{ construction.name }}</p>
                </div>
              </md-list-item>      

              <div *ngIf="showEmptySelectionMessage()" class="empty-selection-message">
                  <p>Clique no item e na seta ao lado para adicionar obras ao relatório.
                  Será gerado relatório com <strong>todas</strong> caso nenhuma seja selecionada.</p>
              </div>
            </virtual-scroll>
          </md-list>
        </div>
      </div>
    </safety-dialog-content>

    <safety-dialog-actions>
      <button md-button class="button-red" [disabled]="constructionReportForm.invalid || this.loading" (click)="doPrintReport()"
      [class.spinner]="this.loading">Gerar Relatório</button>
    </safety-dialog-actions>
  </safety-dialog>
</form>