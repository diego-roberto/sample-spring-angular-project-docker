<form [formGroup]="supplierReportForm" fxFlex="100">
  <safety-dialog>
    <safety-dialog-header>
      Gerar Relatório
    </safety-dialog-header>

    <safety-dialog-content fxLayout="column">
      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar Relatório
      </md-card-subtitle>

      <md-select id="supplier-report-type" formControlName="supplierReportType" fxFlex="100">
        <md-option *ngFor="let reportType of supplierReportType.values()" [value]="reportType">{{ getReportLabelByType(reportType) }}</md-option>
      </md-select>

      <md-card-subtitle fxFlex="100" fxLayoutAlign="start center">
        Selecionar o Período
      </md-card-subtitle>

      <div fxlayout="row" fxLayout.lt-md="column" fxLayoutGap="2em">
        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.initialPeriod" dateMask="99/99/9999" formControlName="initialPeriod" [mdDatepicker]="initialPeriodDatePicker" placeholder="data início">
          <button mdSuffix [mdDatepickerToggle]="initialPeriodDatePicker"></button>
          <md-datepicker #initialPeriodDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorForm('initialPeriod', 'initialAfterFinalPeriod')">data maior que a data final.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialPeriod', 'invalid')">data inválida.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('initialPeriod', 'required') && !hasErrorFormAndTouched('initialPeriod', 'invalid')">campo obrigatório.</md-error>
        </md-input-container>

        <md-input-container fxFlex="100">
          <input required mdInput [(ngModel)]="reportRequest.finalPeriod" dateMask="99/99/9999" formControlName="finalPeriod" [mdDatepicker]="finalPeriodDatePicker" placeholder="data fim">
          <button mdSuffix [mdDatepickerToggle]="finalPeriodDatePicker"></button>
          <md-datepicker #finalPeriodDatePicker></md-datepicker>
          <md-error *ngIf="hasErrorForm('finalPeriod', 'initialAfterFinalPeriod')">data menor que a data inicial.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('finalPeriod', 'invalid')">data inválida.</md-error>
          <md-error *ngIf="hasErrorFormAndTouched('finalPeriod', 'required') && !hasErrorFormAndTouched('finalPeriod', 'invalid')">campo obrigatório.</md-error>
        </md-input-container>
      </div>

      <div fxLayout="row" fxLayout.lt-md="column">
        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <h6>Selecione os fornecedores</h6>

          <md-input-container>
            <md-icon mdPrefix>search</md-icon>
            <input mdInput #filter (input)="doFilterSuppliers(filter.value)" placeholder="Buscar por nome fantasia ou CNPJ">
            <md-icon mdSuffix (click)="doClearFilterSuppliers()">clear</md-icon>
          </md-input-container>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToAdd()" [checked]="isAllToAdd()" [disabled]="isAllToAddDisabled()">Selecionar Todos</md-checkbox>
              <md-checkbox (change)="setActiveSuppliersFilter()" [checked]="checkedActive">Ocultar Inativos</md-checkbox>
            </md-list-item>
            <virtual-scroll #suppliersVirtualScroll [items]="suppliersFiltered" [childHeight]="50" (update)="suppliersVirtualScrollItems = $event">
              <md-list-item *ngFor="let supplier of suppliersVirtualScrollItems">
                <md-checkbox (change)="setSelectedToAdd(supplier)" [checked]="selectedToAdd.includes(supplier)"></md-checkbox>
                <div>
                  <b>{{ supplier.traddingName }}</b> <br/>
                  <a>{{ supplier.cnpj | cnpjMask }}</a>
                </div>
              </md-list-item>
            </virtual-scroll>
          </md-list>
        </div>

        <div fxLayout="column" fxLayout.lt-md="row" class="button-group" fxLayoutAlign="end none">
            <button md-button [disabled]="isDoAddDisabled()" (click)="doAdd()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_right</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_down</md-icon>
            </button>
            <button md-button [disabled]="isDoRemoveDisabled()" (click)="doRemove()">
                <md-icon fxHide.lt-md fxShow.gt-sm>keyboard_arrow_left</md-icon>
                <md-icon fxHide.gt-sm fxShow.lt-md>keyboard_arrow_up</md-icon>
            </button>
        </div>

        <div fxFlex="45" fxFlex.lt-md="100" fxLayout="column" fxLayoutAlign="end none">
          <h6>Fornecedores <span class="red-text-highlighted">selecionados</span> ({{ suppliersSelected ? suppliersSelected.length : 0 }})</h6>

          <md-list>
            <md-list-item class="btn-all">
              <md-checkbox (change)="setAllToRemove()" [checked]="isAllToRemove()" [disabled]="isAllToRemoveDisabled()"></md-checkbox>
              <div>
                <p class="bolder">Selecionar Todos</p>
              </div>
            </md-list-item>

            <virtual-scroll #suppliersSelectedVirtualScroll [items]="suppliersSelectedFiltered" [childHeight]="50" (update)="suppliersSelectedVirtualScrollItems = $event">
              <md-list-item *ngFor="let supplier of suppliersSelectedVirtualScrollItems">
                <md-checkbox (change)="setSelectedToRemove(supplier)" [checked]="selectedToRemove.includes(supplier)"></md-checkbox>
                <div>
                  <b class="bolder">{{ supplier.traddingName }}</b> <br/>
                  <a>{{ supplier.cnpj | cnpjMask }}</a>
                </div>
              </md-list-item>

              <div *ngIf="showEmptySelectionMessage()" class="empty-selection-message">
                <p>Marque o item e clique na seta ao lado para</p>
                <p>adicionar fornecedores ao relatório.</p>
                <br/>
                <a>Aplicar filtro ocultar inativos antes de selecionar todos</a>
              </div>
            </virtual-scroll>
          </md-list>
        </div>
      </div>
    </safety-dialog-content>

    <safety-dialog-actions>
      <button md-button class="button-red" [disabled]="supplierReportForm.invalid || this.loading" (click)="doPrintReport()"
      [class.spinner]="this.loading">Gerar Relatório</button>
    </safety-dialog-actions>
  </safety-dialog>
</form>
